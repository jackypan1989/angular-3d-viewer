/**
 * Angular 3d Viewer
 * @version v0.0.1 - 2014-04-25
 * @link http://jackypan1989.github.com/angular-3d-viewer
 * @author Guan Yu Pan
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-3d-viewer",[]),angular.module("angular-3d-viewer").directive("viewer",function(){return{restrict:"E",replace:!0,template:'<canvas id="mainCanvas"></canvas>',link:function(a){function b(){g=new THREE.WebGLRenderer({canvas:document.getElementById("mainCanvas")}),g.setSize(n,o),g.setClearColor(15658734),h=new THREE.Scene,i=new THREE.PerspectiveCamera(75,n/o,1,1e4),i.position.set(0,0,70),h.add(i),j=new THREE.TrackballControls(i,document.getElementById("mainCanvas")),j.addEventListener("change",e);var a=new THREE.DirectionalLight(16777215);a.position.x=0,a.position.y=0,a.position.z=1,a.position.normalize(),h.add(a),a=new THREE.DirectionalLight(16777215),a.position.x=0,a.position.y=0,a.position.z=-1,a.position.normalize(),h.add(a);new THREE.MeshPhongMaterial({ambient:5592405,color:11184810,specular:1118481,shininess:200});k=new THREE.STLLoader,k.addEventListener("load",function(a){var b=a.content;b.computeFaceNormals();var c;c="tooth"===a.info.type?new THREE.Mesh(b,new THREE.MeshLambertMaterial({overdraw:!0,color:16777215})):new THREE.Mesh(b,new THREE.MeshLambertMaterial({overdraw:!0,color:15766964})),c.info=a.info,c.position=new THREE.Vector3(0,0,0),l.push(c),h.add(c)}),c()}function c(){for(var a=0;1>a;a+=1){for(var b=1;16>=b;b+=1)k.load("./models/example/stage"+a+"/Tooth_"+b+".stl",{stage:a,type:"tooth",location:"top"});for(var b=17;32>=b;b+=1)k.load("./models/example/stage"+a+"/Tooth_"+b+".stl",{stage:a,type:"tooth",location:"btm"});k.load("./models/example/stage"+a+"/Tooth_UpperJaw.stl",{stage:a,type:"jaw",location:"top"}),k.load("./models/example/stage"+a+"/Tooth_LowerJaw.stl",{stage:a,type:"jaw",location:"btm"})}d()}function d(){if(p)for(var a=0;a<l.length;a++)l[a].rotation.y+=.01;requestAnimationFrame(d),j.update(),e()}function e(){g.render(h,i)}function f(a){k.load("./models/"+a,a)}var g,h,i,j,k,l=[],m=0,n=800,o=600,p=!1;b(),a.toggleTop=function(){console.log(l);for(var a=0;a<l.length;a++)"top"===l[a].info.location&&(l[a].visible=!l[a].visible)},a.toggleBtm=function(){for(var a=0;a<l.length;a++)"btm"===l[a].info.location&&(l[a].visible=!l[a].visible)},a.viewFromTop=function(){i.position.set(0,50,0);var a=new THREE.Vector3(0,0,0);i.lookAt(a)},a.viewFromBottom=function(){i.position.set(0,-100,0);var a=new THREE.Vector3(0,0,0);i.lookAt(a)},a.viewFromSide=function(){i.position.set(0,0,70);var a=new THREE.Vector3(0,0,0);i.lookAt(a)},a.nextStep=function(){m++,m>mesh.length-1&&(m=0);for(var a=0;a<mesh.length;a++)mesh[a].visible=!1;mesh[m].visible=!0},a.play=function(){p=!0},a.stop=function(){p=!1},a.load=function(){var a=document.getElementById("files");a.addEventListener("change",function(){for(var b=0,c=a.files,d=c.length;d>b;b++)console.log(c[b]),console.log("Filename: "+c[b].name),console.log("Type: "+c[b].type),console.log("Size: "+c[b].size+" bytes")},!1),f(a.files[0].name)}}}});