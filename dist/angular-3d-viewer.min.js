/**
 * Angular 3d Viewer
 * @version v0.0.1 - 2014-04-24
 * @link http://jackypan1989.github.com/angular-3d-viewer
 * @author Guan Yu Pan
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-3d-viewer",[]),angular.module("angular-3d-viewer").directive("viewer",function(){return{restrict:"E",replace:!0,template:'<canvas id="mainCanvas"></canvas>',link:function(a){function b(){f=new THREE.WebGLRenderer({canvas:document.getElementById("mainCanvas")}),f.setSize(n,o),f.setClearColor(15658734),g=new THREE.Scene,h=new THREE.PerspectiveCamera(75,n/o,1,1e4),h.position.set(0,0,70),g.add(h),i=new THREE.TrackballControls(h,document.getElementById("mainCanvas")),i.addEventListener("change",d);var a=new THREE.DirectionalLight(16777215);a.position.x=0,a.position.y=0,a.position.z=1,a.position.normalize(),g.add(a);new THREE.MeshPhongMaterial({ambient:5592405,color:11184810,specular:1118481,shininess:200});j=new THREE.STLLoader,j.addEventListener("load",function(a){var b=a.content;b.computeFaceNormals(),k[l]=new THREE.Mesh(b,new THREE.MeshLambertMaterial({overdraw:!0,color:11141120,shading:THREE.FlatShading})),k[l].position=new THREE.Vector3(0,-30,0),g.add(k[l]),c()})}function c(){if(p)for(var a=0;a<k.length;a++)k[a].rotation.y+=.01;requestAnimationFrame(c),i.update(),d()}function d(){f.render(g,h)}function e(a){j.load("./models/"+a)}var f,g,h,i,j,k=[],l=0,m=0,n=800,o=600,p=!1;b(),a.viewFromTop=function(){h.position.set(0,50,0);var a=new THREE.Vector3(0,0,0);h.lookAt(a)},a.viewFromBottom=function(){h.position.set(0,-100,0);var a=new THREE.Vector3(0,0,0);h.lookAt(a)},a.viewFromSide=function(){h.position.set(0,0,70);var a=new THREE.Vector3(0,0,0);h.lookAt(a)},a.nextStep=function(){m++,m>k.length-1&&(m=0);for(var a=0;a<k.length;a++)k[a].visible=!1;k[m].visible=!0},a.play=function(){p=!0},a.stop=function(){p=!1},a.load=function(){var a=document.getElementById("files");a.addEventListener("change",function(){for(var b=0,c=a.files,d=c.length;d>b;b++)console.log(c[b]),console.log("Filename: "+c[b].name),console.log("Type: "+c[b].type),console.log("Size: "+c[b].size+" bytes")},!1),e(a.files[0].name)}}}});